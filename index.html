<!DOCTYPE html>
<html>

<head>
	<script src="./jquery-3.4.1.slim.min.js"></script>
	<script type="text/javascript" src="./app.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
	<!-- jQuery Modal -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>The Ultimate Pacman</title>
	<link rel="stylesheet" href="./index.css" />
	<style>
		* {
			margin: 0;
			padding: 0;
		}
	</style>
</head>

<body>
	<!-- div style="text-align: center; display: flex; flex-direction: row ; align-items: center ; justify-content: center" -->
	<!-- Header-->
		<div class="header">
			<h1>
				<img class="logo" src="https://images.all-free-download.com/images/graphiclarge/pacman_56054.jpg" width="40" height="30"
				 style=" padding-top:0.2vw; padding-left: 0.2vw;" />
				<span class="alt-logo" style=" font-size: 2vw;">The Ultimate Pacman</span>
			</h1>
		</div>

		<!-- Menu -->
		<div class="scrollmenu">
			<button class="nav" value="welcome" id="welcome_button" href="">Welcome</button>
			<button class="nav" value="welcome" href="">Login & Registration</button>
			<a class="nav" value="about" href="" rel="modal:open">About</a>
		</div>
	<!--/div -->

	<div class="content">
		<!-- Welcome content-->
		<div class="welcome_content">
			<section class="container">
				<article class="half">
					<div class="tabs">
						<span class="tab signin active">
							<a>Sign in</a>
						</span>
						<span class="tab signup">
							<a>Sign up</a>
						</span>
					</div>
					<div class="content">

						<!-- Sign in -->
						<div class="signin-cont cont" id="signin_content">
							<form  name="signin" method="post" enctype="multipart/form-data">

								<input type="name" name="username_signin" id="username_signin" class="inpt" placeholder="Your username">
								<label for="username">Your username</label>

								<input type="password" name="password_signin" id="password_signin" class="inpt" placeholder="Your password">
								<label for="password">Your password</label>

								<div class="submit-wrap">
									<input type="submit" value="Sign in" class="submit">
								</div>
							</form>
						</div>

						<!-- Sign out -->
						<div class="signout-cont cont" id="signout_content" style="display:none;">
							<form  name="signout" method="post" enctype="multipart/form-data">
								<div class="submit-wrap">
									<input type="submit" value="Sign Out" class="submit">
								</div>
							</form>
						</div>

						<!-- Sign up -->
						<div class="signup-cont cont">
							<form  name="signup" method="post" enctype="multipart/form-data">

								<input type="name" name="first" id="first" class="inpt" placeholder="Your first name">
								<label for="first">Your first name</label>

								<input type="name" name="last" id="last" class="inpt" placeholder="Your last name">
								<label for="last">Your last name</label>

								<input type="date" name="birth" id="birth" class="inpt" placeholder="Your date of birth">
								<label for="birth">Your date of birth</label>

								<input type="name" name="username" id="username" class="inpt" placeholder="Your username">
								<label for="username">Your username</label>

								<input type="email" name="email" id="email" class="inpt" placeholder="Your email">
								<label for="email">Your email</label>

								<input type="password" name="password" id="password" class="inpt" placeholder="Your password">
								<label for="password">Your password</label>

								<div class="submit-wrap">
									<input type="submit" value="Sign Up" class="submit">
								</div>
							</form>
						</div>
					</div>
				</article>
			</section>

		</div>

		<!-- About content-->
		<div id="about" class="about_content" class="modal" style="display:none;">
			<p>Made by Yuval Lapidot, Ori Eldar</p>
			<p>Plugins: jQuery Modal, Jquery Validate</p>
		</div>

		<!-- Options content-->
		<div id="options_content" class="options_content" style="display:none;">

			<section class="container">
				<article class="half">
					<div class="content">
						<div class="content">
							<form name="options" method="post" enctype="multipart/form-data">
								<!-- Keys -->
								<p class="arrow_field"> Up Key : <input name="up_key" id="up_key" value="ArrowUp" class="inpt arrow" placeholder="Up Key" ></p>
								<p class="arrow_field">Down Key: <input name="down_key" id="down_key" value="ArrowDown" class="inpt arrow" placeholder="Down Key"></p>
								<p class="arrow_field">Right Key: <input name="right_key" id="right_key" class="inpt arrow" value="ArrowRight"  placeholder="Right Key"></p>
								<p class="arrow_field">Left Key: <input name="left_key" id="left_key" class="inpt arrow" value="ArrowLeft"  placeholder="Left Key"></p>

								<span id="ball_amount">Number of food: 50</span>
								<input type="range" min="50" max="90" name="balls" value="50" id="balls" class="inpt" placeholder="Number of balls">

								<p>Ball color 5 pts &nbsp;
								<input type="color" value="#e66465" name="balls_colors" id="balls_colors1" class="" placeholder="Ball Colors">
								</p>
								<p>Ball color 10 pts
								<input type="color" value="#66C800" name="balls_colors" id="balls_colors2" class="" placeholder="Ball Colors"></p>

								<p>Ball color 25 pts
								<input type="color" value="#000000" name="balls_colors" id="balls_colors3" class="" placeholder="Ball Colors"></p>
								<br/>
								<p class="arrow_field"> Total Time (s): <input type="number" min="60" name="time_set" id="time_set" value="60" class="inpt arrow" placeholder="Time in seconds"> </p>

								<span id="monster_amount">Number of monsters: 2</span>
								<input type="range" min="1" max="4" value="2" name="monsters" id="monsters" class="inpt" placeholder="Number of monsters">
								<label for="monsters">Number of monsters</label>

								<div class="submit-wrap">
									<input id="random_settings" type="button" value="Random" class="submit">
									<input type="submit" value="Continue To Game" class="submit">
								</div>


							</form>
						</div>
					</div>
				</article>
			</section>
		</div>



		<!-- Game content-->
		<div class="game_content" style="display:none;">
			<ul id="game_data">
				<li class="game_test" style="display:inline;">
					Username: <span id="username_display" > </span>
				</li>
				<li style="display:inline">
					<button id="start_game">START GAME</button>
				</li>
				<li id="score" class="game_test" style="display:inline;">
					<label for="lblScore">SCORE:</label>
					<input id="lblScore" style="max-width: 80px" type="text" />
				</li>
				<li id="time" style="display:inline;">
					<label for="lblTime">TIME:</label>
					<input id="lblTime"  style="max-width: 80px"  type="text" />
				</li>

				<li id="lives" style="display:inline;">
					<label for="lblLives">Lives:</label>
					<input id="lblLives"  style="max-width: 80px"  type="text" />
				</li>
			</ul>

			<section id="game">

				<div id="canvas_wrapper">
					<canvas id="canvas" height="540" width="750"></canvas>
				</div>
				<div class="settings">
					<p style="text-align:center"><b>GAME SETTINGS</b> </p>
					<br/>
					<p> Up Key: <span id="settings_up_key"> </span></p>
					<p> Down Key: <span id="settings_down_key"> </span> </p>
					<p> Right Key:<span id="settings_right_key"> </span> </p>
					<p> Left Key: <span id="settings_left_key"> </span> </p>
					<p> Number Of Balls: <span id="settings_ball_amount"></span> </p>
					<p >Ball 5 pts &nbsp; <input type="color" value="#e66465" id="settings_balls_colors1" disabled/> </p>
					<p >Ball 10 pts <input type="color" value="#66C800" id="settings_balls_colors2" disabled/> </p>
					<p >Ball 25 pts <input type="color" value="#000000"  id="settings_balls_colors3" disabled/> </p>
					<p >Total Game Time (s): <span id="settings_time_set"> </span> </p>
					<p >Number Of Monsters: <span id="settings_monster_amount"></span> </p>
				</div>

				<script>
				var settings = JSON.parse(localStorage.getItem("settings"));

				$("#settings_up_key").text(settings.UpKey);
				$("#settings_down_key").text(settings.DownKey);
				$("#settings_left_key").text(settings.LeftKey);
				$("#settings_right_key").text(settings.RightKey);
				$("#settings_ball_amount").text(settings.NumberOfBalls);
				$("#settings_balls_colors1").val(settings.BallColor1);
				$("#settings_balls_colors2").val(settings.BallColor2);
				$("#settings_balls_colors3").val(settings.BallColor3);
				$("#settings_monster_amount").text(settings.NumberOfMonsters);
				$("#settings_time_set").text(settings.TimesSet);
				</script>
			</section>
		</div>
	</div>


	<footer class="site-footer">
		The Ultimate Pacman, Yuval&Ori. Contact: Yuval&Ori@example.com
	</footer>
	<script>
		function randomIntFromRange(min, max) {
			return Math.floor(Math.random() * (max - min + 1) + min);
		}

		$("#up_key").on("keydown", function search(e) {
			setTimeout( () => $(this).val(e.key) , 5);
			localStorage.setItem("up_keycode", e.keyCode)
		});

		$("#down_key").on("keydown", function search(e) {
			setTimeout( () => $(this).val(e.key) , 5);
			localStorage.setItem("down_keycode", e.keyCode)
		});

		$("#left_key").on("keydown", function search(e) {
			setTimeout( () => $(this).val(e.key) , 5);
			localStorage.setItem("left_keycode", e.keyCode)
		});

		$("#right_key").on("keydown", function search(e) {
			setTimeout( () => $(this).val(e.key) , 5);
			localStorage.setItem("right_keycode", e.keyCode)
		});

		$("#balls").on("change", function changed(e) {
			$("#ball_amount").text("Number of food: " + $(this).val());
		});

		$("#monsters").on("change", function changed(e) {
			$("#monster_amount").text("Number of monsters: " + $(this).val());
		});

		$("#random_settings").on("click", function changed(e) {
			$("#balls").val(randomIntFromRange(50,90));
			$("#monsters").val(randomIntFromRange(1,4));
			$("#time_set").val(randomIntFromRange(60,200));
			$("#balls_colors1").val("#" + Math.floor(Math.random()*16777215).toString(16));
			$("#balls_colors2").val("#" + Math.floor(Math.random()*16777215).toString(16));
			$("#balls_colors3").val("#" + Math.floor(Math.random()*16777215).toString(16));
			$("#monster_amount").text("Number of monsters: " + $("#monsters").val());
			$("#ball_amount").text("Number of monsters: " + $("#balls").val());
		});


		if (!localStorage.getItem('signed_in')) {
			//signed out setup
			$("#welcome_button").val('welcome')
			$("#signout_content").hide()
			$("#signin_content").show()
			$("div.options_content").hide();
			$("div.welcome_content").show();
		}
		else {
			//signed in setup
			$("#welcome_button").val('options');
			$("#welcome_button").text('options');
			$("#signin_content").hide()
			$("#signout_content").show()
			$("div.welcome_content").hide();
			$("div.options_content").show();
			var game_started = localStorage.getItem('game_started')
			if (game_started) {
				$("div.options_content").hide()
				$("div.game_content").show()
			}
			else {
				$("div.game_content").hide()
				$("div.options_content").show();
					localStorage.setItem("up_keycode", "38");
					localStorage.setItem("down_keycode", "40");
					localStorage.setItem("left_keycode", "37");
					localStorage.setItem("right_keycode", "39");
			}
		}

		if (!localStorage.getItem('users'))
			localStorage.setItem('users', JSON.stringify([{ username: 'p', password: 'p' }]))

		const contents = ['welcome', 'login', 'register', 'about', 'options', 'game', 'signout']
		$("button.nav").click(function () {

			if($(this).val() == "options"){
				localStorage.setItem("up_keycode", "38");
				localStorage.setItem("down_keycode", "40");
				localStorage.setItem("left_keycode", "37");
				localStorage.setItem("right_keycode", "39");
			}
			localStorage.removeItem('game_started');
			contents.forEach(content => $(this).val() === content ? $('div.' + $(this).val() + '_content').show() : $('div.' + content + '_content').hide())
		});
		$('.tabs .tab').click(function () {
			if ($(this).hasClass('signin')) {
				$('.tabs .tab').removeClass('active');
				$(this).addClass('active');
				$('.cont').hide();
				if (localStorage.getItem('signed_in')) {
					$('.signin-cont').hide();
					$('.signout-cont').show();
				}
				else {
					$('.signout-cont').hide();
					$('.signin-cont').show();
				}
			}
			if ($(this).hasClass('signup')) {
				$('.tabs .tab').removeClass('active');
				$(this).addClass('active');
				$('.cont').hide();
				$('.signup-cont').show();
			}
		});
		$('.container .bg').mousemove(function (e) {
			var amountMovedX = (e.pageX * -1 / 30);
			var amountMovedY = (e.pageY * -1 / 9);
			$(this).css('background-position', amountMovedX + 'px ' + amountMovedY + 'px');
		});

		$("form").submit(function (event) {
			var users = JSON.parse(localStorage.getItem('users'))
			var values = $(this).serializeArray();
			const options_form_identifier = 'up_key';
			if (values[0] && values[0]['name'] === options_form_identifier) {
				localStorage.setItem('game_started', true)

				/*
				options form
				ori fill here
				*/
				var settings = {
					UpKey : $("#up_key").val(),
					DownKey : $("#down_key").val(),
					LeftKey : $("#left_key").val(),
					RightKey : $("#right_key").val(),
					NumberOfBalls: $("#balls").val(),
					BallColor1 : $("#balls_colors1").val(),
					BallColor2 : $("#balls_colors2").val(),
					BallColor3 : $("#balls_colors3").val(),
					NumberOfMonsters : $("#monsters").val(),
					TimesSet :  $("#time_set").val()
				};
				localStorage.setItem('settings', JSON.stringify(settings));

				console.log("options form submitted, you may change the identifier")
			}

			else if (!values[0]) {
				//signout
				localStorage.removeItem('signed_in');
			}

			else if (values[2]) {
				//signup				
				var username = values[3]['value']
				var password = values[5]['value']
				users.push({ username: username, password: password })
				localStorage.setItem('users', JSON.stringify(users))
				localStorage.removeItem('signed_in');
			}

			else {
				//signin
				var signed_in = {}

				users.forEach(user => {
					if (user['username'] === values[0]['value'] &&
						user['password'] === values[1]['value']
					) {
						localStorage.setItem('signed_in', true);
						localStorage.setItem('username', user['username']);
						signed_in = true;
						alert("Signed In!")
					}

				})
				if (signed_in !== true) {
					alert("Password or username incorrect")
					localStorage.removeItem('signed_in');
					event.preventDefault();
					return false;
				}
			}
		});

		$.validator.addMethod("namecheck", function (value) {
			return /^[A-Za-z]*$/.test(value) // consists of only these
		});

		$.validator.addMethod("passwordcheck", function (value) {
			return /^[A-Za-z0-9\d=!\-@._*]*$/.test(value) // consists of only these
				&& /[a-z]/.test(value) // has a lowercase letter
				&& /\d/.test(value) // has a digit
		});

		// Wait for the DOM to be ready
		$(function () {
			// Initialize form validation on the registration form.
			// It has the name attribute "registration"
			$("form[name='signup']").validate({
				// Specify validation rules
				rules: {
					// The key name on the left side is the name attribute
					// of an input field. Validation rules are defined
					// on the right side
					username: "required",
					birth: "required",
					first: {
						required: true,
						namecheck: true
					},
					last: {
						required: true,
						namecheck: true
					},
					email: {
						required: true,
						// Specify that email should be validated
						// by the built-in "email" rule
						email: true
					},
					password: {
						required: true,
						minlength: 6,
						passwordcheck: true,
					}
				},
				// Specify validation error messages
				messages: {
					username: {
						required: "Please provide a username",
					},
					first: {
						required: "Please provide a first name",
						namecheck: "Please enter valid first name without digits"
					},
					last: {
						required: "Please provide a last name",
						namecheck: "Please enter valid last name without digits",
					},
					birth: {
						required: "Please provide a birth of date",
					},
					password: {
						required: "Please provide a password",
						minlength: "Your password must be at least 6 characters long",
						passwordcheck: "Please provide a valid password with letters and digits",
					},
					email: {
						required: "Please provide an email address",
						email: "Please enter a valid email address"
					},

				},
				// Make sure the form is submitted to the destination defined
				// in the "action" attribute of the form when valid
				submitHandler: function (form) {
					form.submit();
				}
			});
		});

		// Wait for the DOM to be ready
		$(function () {
			// Initialize form validation on the registration form.
			// It has the name attribute "registration"
			$("form[name='signin']").validate({
				// Specify validation rules
				rules: {
					// The key name on the left side is the name attribute
					// of an input field. Validation rules are defined
					// on the right side
					username: "required",

					password: {
						required: true
					}
				},
				// Specify validation error messages
				messages: {
					username: {
						required: "Please provide a username",
					},

					password: {
						required: "Please provide a password",
					},

				},
				// Make sure the form is submitted to the destination defined
				// in the "action" attribute of the form when valid
				submitHandler: function (form) {
					form.submit();
				}
			});
		});


	</script>
</body>

</html>